<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUDZASO - Admin Dashboard</title>
    <link rel="stylesheet" href="admin-style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Estilos específicos para la nueva vista de My Tasks sin tocar los tuyos */
        .hidden { display: none !important; }
        .stats-grid-mini { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-card-mini { background: white; padding: 20px; border-radius: 12px; border: 1px solid #e2e8f0; }
        .stat-card-mini .label { font-size: 13px; color: #64748b; font-weight: 500; display: block; margin-bottom: 8px; }
        .stat-card-mini .value { font-size: 28px; font-weight: 800; color: #1e293b; }
        .icon-box-blue { color: #3b82f6; background: #eff6ff; width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; border-radius: 8px; }
        .category-badge { background: #f1f5f9; color: #475569; padding: 5px 12px; border-radius: 6px; font-size: 12px; font-weight: 600; }
        .status-pill { padding: 5px 15px; border-radius: 20px; font-size: 12px; font-weight: 600; text-transform: capitalize; }
        .status-pill.completed { background: #dcfce7; color: #15803d; }
        .status-pill.pending { background: #fef3c7; color: #b45309; }
        .status-pill.in-progress { background: #dbeafe; color: #1d4ed8; }

        /* Estilos para el Formulario de Creación (Figma) */
        .form-container { background: white; padding: 40px; border-radius: 12px; border: 1px solid #e2e8f0; max-width: 850px; margin-top: 20px; }
        .form-group { margin-bottom: 24px; }
        .form-group label { display: block; font-size: 13px; font-weight: 600; color: #334155; margin-bottom: 8px; }
        .form-input { width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; outline: none; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
        .btn-save { background: #4f46e5; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        .btn-cancel { background: #f1f5f9; color: #475569; border: none; padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer; }

        /* NUEVOS ESTILOS PROFILE (FIGMA) */
        .profile-layout { display: grid; grid-template-columns: 320px 1fr; gap: 30px; align-items: start; }
        .profile-card { background: white; border-radius: 16px; border: 1px solid #e2e8f0; padding: 30px; }
        .profile-main-card { text-align: center; }
        .profile-img { width: 110px; height: 110px; border-radius: 50%; margin-bottom: 15px; border: 3px solid #f1f5f9; }
        .badge-role { background: #eff6ff; color: #2563eb; padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: 700; }
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-top: 20px; }
        .grid-item label { font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 700; margin-bottom: 5px; display: block; }
        .grid-item p { font-size: 14px; font-weight: 600; color: #334155; }
        .dept-badge { background: #fff7ed; color: #c2410c; padding: 4px 10px; border-radius: 6px; font-size: 12px; }
        .btn-edit-profile { background: white; border: 1px solid #e2e8f0; padding: 8px 15px; border-radius: 8px; font-size: 12px; font-weight: 600; cursor: pointer; }
    </style>
</head>
<body>

    <aside class="sidebar">
        <div class="logo-container">
            <div class="logo-red-box">
                <svg viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M10 2h4l1 4h-6l1-4z"></path>
                    <path d="M10 6l-1 9 3 7 3-7-1-9h-4z"></path>
                    <line x1="11" y1="10" x2="13" y2="10"></line>
                    <line x1="10.5" y1="14" x2="13.5" y2="14"></line>
                </svg>
            </div>
            <span style="font-size: 20px; font-weight: bold;">CRUDZASO</span>
        </div>
        <nav style="margin-top: 16px;">
            <a href="#" id="link-dashboard" onclick="changeView('dashboard')" class="nav-link active"><i class="fa-solid fa-border-all"></i> Dashboard</a>
            <a href="#" id="link-mytasks" onclick="changeView('mytasks')" class="nav-link"><i class="fa-solid fa-list-check"></i> My Tasks</a>
            <a href="#" id="link-profile" onclick="changeView('profile')" class="nav-link"><i class="fa-solid fa-user"></i> Profile</a>
        </nav>
    </aside>

    <main style="flex: 1; display: flex; flex-direction: column;">
        <header>
            <div style="font-size: 11px; color: #94a3b8; font-weight: 600;">
                <i class="fa-solid fa-house"></i> <span id="breadcrumb" style="margin-left: 8px;">/ Dashboard</span>
            </div>
            <div style="display: flex; align-items: center; gap: 16px;">
                <i class="fa-solid fa-bell" style="color: #cbd5e1; cursor: pointer;"></i>
                <div style="display: flex; align-items: center; gap: 12px; border-left: 1px solid #e2e8f0; padding-left: 16px;">
                    <div style="text-align: right;">
                        <p id="admin-name" style="font-size: 12px; font-weight: 800; color: #334155;">Admin User</p>
                        <p style="font-size: 9px; color: #94a3b8; font-weight: bold;">SYSTEM ADMIN</p>
                    </div>
                    <img src="https://ui-avatars.com/api/?name=Admin&background=cbd5e1&color=475569" style="width: 32px; height: 32px; border-radius: 50%;">
                    <button onclick="logout()" class="btn-logout-red"><i class="fa-solid fa-right-from-bracket"></i></button>
                </div>
            </div>
        </header>

        <section id="view-dashboard" style="padding: 24px 32px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px;">
                <div>
                    <h2 style="font-size: 28px; font-weight: 900; color: #1e293b;">Task Manager</h2>
                    <p style="color: #94a3b8; font-size: 14px;">Overview of your current academic performance tasks.</p>
                </div>
                <button onclick="changeView('create-task')" style="background: #2563eb; color: white; border: none; padding: 12px 24px; border-radius: 12px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);">
                    + New Task
                </button>
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">Total Tasks <i class="fa-solid fa-layer-group" style="color:#3b82f6;"></i></div>
                    <p class="stat-number" id="stat-total">0</p>
                    <p class="label-green">↑ +12% from last week</p>
                </div>
                <div class="stat-card">
                    <div class="stat-header">Completed <i class="fa-solid fa-circle-check" style="color:#22c55e;"></i></div>
                    <p class="stat-number" id="stat-completed">0</p>
                    <p class="label-green">✓ On track</p>
                </div>
                <div class="stat-card">
                    <div class="stat-header">Pending <i class="fa-solid fa-clock" style="color:#f97316;"></i></div>
                    <p class="stat-number" id="stat-pending">0</p>
                    <p class="label-orange">2 High Priority</p>
                </div>
                <div class="stat-card">
                    <div class="stat-header">Overall Progress <i class="fa-solid fa-chart-line" style="color:#a855f7;"></i></div>
                    <p class="stat-number" id="stat-progress">75%</p>
                    <p class="label-green">Keep it up!</p>
                </div>
            </div>
            <div class="table-section">
                <table>
                    <thead>
                        <tr>
                            <th>Task Name</th>
                            <th>Assignee</th>
                            <th>Status</th>
                            <th>Priority</th>
                            <th>Due Date</th>
                            <th style="text-align:center;">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="admin-taskList"></tbody>
                </table>
            </div>
        </section>

        <section id="view-mytasks" class="hidden" style="padding: 24px 32px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <div>
                    <h2 style="font-size: 28px; font-weight: 900; color: #1e293b;">Task Management</h2>
                </div>
                <button onclick="changeView('create-task')" style="background: #2563eb; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-weight: bold; cursor: pointer;">
                    + New Task
                </button>
            </div>
            <div class="stats-grid-mini">
                <div class="stat-card-mini"><span class="label">Total Tasks</span><div class="value" id="mini-total">0</div></div>
                <div class="stat-card-mini"><span class="label">In Progress</span><div class="value" id="mini-progress">0</div></div>
                <div class="stat-card-mini"><span class="label">Completed</span><div class="value" id="mini-completed">0</div></div>
                <div class="stat-card-mini"><span class="label">Pending</span><div class="value" id="mini-pending">0</div></div>
            </div>
            <div style="background: white; border-radius: 12px; border: 1px solid #e2e8f0; overflow: hidden;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead style="background: #f8fafc; text-align: left;">
                        <tr style="font-size: 11px; color: #64748b; text-transform: uppercase;">
                            <th style="padding: 16px;"><input type="checkbox"></th>
                            <th style="padding: 16px;">Task Name</th>
                            <th style="padding: 16px;">Category</th>
                            <th style="padding: 16px;">Priority</th>
                            <th style="padding: 16px;">Status</th>
                        </tr>
                    </thead>
                    <tbody id="mytasks-list"></tbody>
                </table>
            </div>
        </section>

        <section id="view-profile" class="hidden" style="padding: 40px; background: #f8fafc; flex:1;">
            <h2 style="font-size: 24px; font-weight: 800; color: #1e293b; margin-bottom: 24px;">My Profile</h2>
            <div class="profile-layout">
                <div class="profile-card profile-main-card">
                    <img src="https://ui-avatars.com/api/?name=Sarah+Jenkins&background=cbd5e1&color=475569" class="profile-img">
                    <h3 style="font-size: 20px; font-weight: 800; color: #1e293b;">Dr. Sarah Jenkins</h3>
                    <span class="badge-role">System Admin</span>
                    <div style="margin-top: 25px; padding: 12px; background: #f8fafc; border-radius: 8px; font-size: 13px; color: #64748b;">
                        <i class="fa-regular fa-envelope"></i> sarah.jenkins@crudzaso.edu
                    </div>
                    <div style="margin-top: 25px;">
                        <span style="font-size: 24px; font-weight: 800; display: block;">154</span>
                        <span style="font-size: 12px; color: #94a3b8; font-weight: 600;">Tasks</span>
                    </div>
                </div>

                <div class="profile-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                        <h4 style="font-size: 16px; font-weight: 700;">Personal Information</h4>
                        <button class="btn-edit-profile"><i class="fa-solid fa-pen"></i> Edit Profile</button>
                    </div>
                    <div class="info-grid">
                        <div class="grid-item"><label>Full Name</label><p>Sarah Jenkins</p></div>
                        <div class="grid-item"><label>Employee ID</label><p>CZ-882103</p></div>
                        <div class="grid-item"><label>Phone</label><p>+1 (555) 123-4567</p></div>
                        <div class="grid-item"><label>Department</label><p><span class="dept-badge">Computer Science</span></p></div>
                        <div class="grid-item"><label>Role Level</label><p>Senior Administrator</p></div>
                        <div class="grid-item"><label>Join Date</label><p>September 14, 2020</p></div>
                    </div>
                </div>
            </div>
        </section>

        <section id="view-create-task" class="hidden" style="padding: 40px 100px; background: #f8fafc; flex:1;">
            <div style="margin-bottom: 24px; color: #64748b; font-size: 13px; font-weight: 500;">
                <span onclick="goBack()" style="cursor:pointer; color: #475569;">← Back</span> / <span style="color: #94a3b8;">Create New</span>
            </div>
            <h2 style="font-size: 28px; font-weight: 800; color: #1e293b; margin-bottom: 32px;">Create New Task</h2>
            <div class="form-container">
                <form id="fullTaskForm">
                    <div class="form-group"><label>Task Title <span style="color: #ef4444;">*</span></label><input type="text" id="full-title" class="form-input" placeholder="e.g., Complete Quarter 3 Report" required></div>
                    <div class="form-row">
                        <div class="form-group"><label>Assign to User</label><select id="full-userId" class="form-input" required></select></div>
                        <div class="form-group"><label>Category</label><select id="full-category" class="form-input"><option>Mathematics</option><option>Physics</option><option>History</option></select></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Priority</label><select id="full-priority" class="form-input"><option>Low</option><option selected>Medium</option><option>High</option></select></div>
                        <div class="form-group"><label>Status</label><select id="full-status" class="form-input"><option value="pending">Pending</option><option value="in-progress">In Progress</option></select></div>
                    </div>
                    <div class="form-group"><label>Due Date</label><input type="date" id="full-date" class="form-input" required></div>
                    <div class="form-group"><label>Description</label><textarea id="full-desc" class="form-input" style="height: 100px; resize: none;"></textarea></div>
                    <div style="display: flex; justify-content: flex-end; gap: 16px;"><button type="button" onclick="goBack()" class="btn-cancel">Cancel</button><button type="submit" class="btn-save">Save Task</button></div>
                </form>
            </div>
        </section>
    </main>

    <script>
        const API_TASKS = "http://localhost:3000/tasks";
        const API_USERS = "http://localhost:3000/users";
        let lastView = 'dashboard';

        function changeView(viewName) {
            if (viewName !== 'create-task') lastView = viewName;

            const views = ['view-dashboard', 'view-mytasks', 'view-create-task', 'view-profile'];
            views.forEach(v => document.getElementById(v).classList.add('hidden'));

            const activeView = document.getElementById(`view-${viewName}`);
            if (activeView) activeView.classList.remove('hidden');

            const breadcrumb = document.getElementById('breadcrumb');
            const links = {
                dashboard: document.getElementById('link-dashboard'),
                mytasks: document.getElementById('link-mytasks'),
                profile: document.getElementById('link-profile')
            };

            // Reset active classes
            Object.values(links).forEach(l => l.classList.remove('active'));

            if (viewName === 'dashboard') {
                breadcrumb.innerText = "/ Dashboard";
                links.dashboard.classList.add('active');
                loadDashboard();
            } else if (viewName === 'mytasks') {
                breadcrumb.innerText = "/ My Tasks";
                links.mytasks.classList.add('active');
                loadMyTasksTable();
            } else if (viewName === 'profile') {
                breadcrumb.innerText = "/ Profile";
                links.profile.classList.add('active');
            } else if (viewName === 'create-task') {
                breadcrumb.innerText = "/ Create New Task";
                loadUserOptionsFull();
            }
        }

        function goBack() { changeView(lastView); }

        async function loadUserOptionsFull() {
            const res = await fetch(API_USERS);
            const users = await res.json();
            const select = document.getElementById('full-userId');
            select.innerHTML = users.filter(u => u.role !== 'admin').map(u => `<option value="${u.id}">${u.name}</option>`).join('');
        }

        async function loadDashboard() {
            try {
                const [tRes, uRes] = await Promise.all([fetch(API_TASKS), fetch(API_USERS)]);
                const tasks = await tRes.json();
                const users = await uRes.json();

                document.getElementById('stat-total').innerText = tasks.length;
                document.getElementById('stat-completed').innerText = tasks.filter(t => t.status === 'completed').length;
                document.getElementById('stat-pending').innerText = tasks.filter(t => t.status !== 'completed').length;

                const container = document.getElementById('admin-taskList');
                container.innerHTML = tasks.map(t => {
                    const user = users.find(u => String(u.id) === String(t.userId)) || { name: 'Student' };
                    return `<tr>
                        <td style="font-weight: bold;">${t.title}</td>
                        <td>${user.name}</td>
                        <td><span class="status-badge ${t.status === 'completed' ? 'bg-completed' : 'bg-in-progress'}">${t.status}</span></td>
                        <td>${t.priority}</td>
                        <td>${t.date || '---'}</td>
                        <td style="text-align:center;"><i onclick="deleteTask('${t.id}')" class="fa-solid fa-trash" style="color: #cbd5e1; cursor:pointer;"></i></td>
                    </tr>`;
                }).join('');
            } catch (err) { console.error(err); }
        }

        async function loadMyTasksTable() {
            const res = await fetch(API_TASKS);
            const tasks = await res.json();
            document.getElementById('mini-total').innerText = tasks.length;
            document.getElementById('mytasks-list').innerHTML = tasks.map(t => `
                <tr style="border-bottom: 1px solid #f1f5f9;">
                    <td style="padding: 16px;"><input type="checkbox"></td>
                    <td style="padding: 16px;"><strong>${t.title}</strong></td>
                    <td style="padding: 16px;"><span class="category-badge">${t.category || 'Academic'}</span></td>
                    <td style="padding: 16px;">${t.priority}</td>
                    <td style="padding: 16px;"><span class="status-pill ${t.status}">${t.status}</span></td>
                </tr>
            `).join('');
        }

        document.getElementById('fullTaskForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = {
                title: document.getElementById('full-title').value,
                userId: document.getElementById('full-userId').value,
                category: document.getElementById('full-category').value,
                priority: document.getElementById('full-priority').value,
                status: document.getElementById('full-status').value,
                date: document.getElementById('full-date').value,
                description: document.getElementById('full-desc').value
            };
            await fetch(API_TASKS, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(data) });
            document.getElementById('fullTaskForm').reset();
            changeView('dashboard');
        });

        async function deleteTask(id) { if(confirm('Delete task?')) { await fetch(`${API_TASKS}/${id}`, { method: 'DELETE' }); loadDashboard(); } }
        function logout() { localStorage.clear(); window.location.href = 'index.html'; }
        loadDashboard();
    </script>
</body>
</html>